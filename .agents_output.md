# Output Requirements

## Files Created / Modified / Deleted

- **Created**: packages/importer/src/exports/constants.ts
- **Modified**: .agents_output.md, packages/importer/package.json, packages/importer/src/exports/exportDataset.ts, apps/web/public/data/v2026-01-30/* (regenerated JSON outputs)
- **Deleted**: packages/importer/src/import-insee.ts, packages/importer/src/insee/**, packages/importer/src/postal-codes/**, packages/importer/src/shared/**

## PowerShell Commands

1. `pnpm install`
2. `pnpm -C packages/importer export:static`

## Generated Files

- `communes/indexLite.json`: tabular columns `["insee","name","departmentCode","regionCode","lat","lng","population"]`, rows sorted by INSEE with averaged Leaflet-ready coordinates from postal codes and `population = null`.
- `communes/postalIndex.json`: JSON dictionary `{ postalCodeToInsee }` mapping each postal code to sorted unique INSEE lists.
- `communes/metrics/core.json`: tabular columns `["insee","areaKm2","densityPopKm2"]`, same commune ordering with null metrics placeholders.
- `communes/metrics/housing.json`: tabular columns `["insee","rentMedianEurM2","rentP25EurM2","rentP75EurM2","rentSourceYear"]`, null placeholders per commune.
- `manifest.json`: schemaVersion 1 manifest referencing dataset files, datasetVersion `vYYYY-MM-DD`, timestamps, and SHA256 checksums for all remote sources.

## INSEE & Postal Mapping Rules

- Filter INSEE data with `TYPECOM === "COM"` only.
- `name` priority: `LIBELLE` → `NCCENR` → `NCC`.
- `insee` codes uppercased and zero-padded to 5 characters; `departmentCode`/`regionCode` uppercased; missing region codes inferred from the department dataset.
- Coordinates computed as the simple average of all postal latitude/longitude pairs per INSEE (rows without complete coordinates are ignored; communes without coordinates keep `null`).
- Postal mapping deduplicates `(postalCode, insee)` pairs and sorts both the postal keys and INSEE arrays.
- Metrics files currently set all metric values to `null` while preserving the tabular schema for future enrichment.

## Expected Log Counters

- `[dataset] Loaded 34875 communes (39201 postal rows, 101 departments)`
- `[indexLite] Exported 34875 communes (34864 with coordinates, 11 without coordinates)`
- `[postalIndex] Exported 6329 postal codes (ignored 0 rows without postal/insee)`
- `[metrics:core] Exported 34875 rows (values are null placeholders)`
- `[metrics:housing] Exported 34875 rows (values are null placeholders)`
